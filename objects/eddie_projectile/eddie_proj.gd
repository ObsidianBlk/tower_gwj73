extends Node3D

# ------------------------------------------------------------------------------
# Signals
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Constants and ENUMs
# ------------------------------------------------------------------------------
const ANIM_EXPLODE : StringName = &"explode"

# ------------------------------------------------------------------------------
# Export Variables
# ------------------------------------------------------------------------------
@export var speed : float = 5.0
@export var direction : Vector3 = Vector3.ZERO
@export var life : float = 240.0

# ------------------------------------------------------------------------------
# Variables
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Onready Variables
# ------------------------------------------------------------------------------
@onready var _hit_box: HitBox = $HitBox
@onready var _asprite: AnimatedSprite3D = $AnimatedSprite3D


# ------------------------------------------------------------------------------
# Setters / Getters
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Override Methods
# ------------------------------------------------------------------------------
func _ready() -> void:
	_hit_box.hit_occured.connect(_on_hit_occured)

func _process(delta: float) -> void:
	position += direction * speed * delta
	if life > 0.0:
		life -= delta
		if life <= 0.0:
			die.call_deferred()

# ------------------------------------------------------------------------------
# Private Methods
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Public Methods
# ------------------------------------------------------------------------------
func die() -> void:
	queue_free()

# ------------------------------------------------------------------------------
# Handler Methods
# ------------------------------------------------------------------------------
func _on_hit_occured() -> void:
	_asprite.play(ANIM_EXPLODE)

func _on_animated_sprite_3d_animation_finished() -> void:
	die.call_deferred()
