extends Area3D
class_name HitBox

# ------------------------------------------------------------------------------
# Signals
# ------------------------------------------------------------------------------
signal hit_occured()

# ------------------------------------------------------------------------------
# Constants and ENUMs
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Export Variables
# ------------------------------------------------------------------------------
@export var min_damage : int = 1
@export var max_damage : int = 10
@export var dpps : float = 0.0

# ------------------------------------------------------------------------------
# Variables
# ------------------------------------------------------------------------------
var _bodies : Dictionary = {}

# ------------------------------------------------------------------------------
# Onready Variables
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Setters / Getters
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Override Methods
# ------------------------------------------------------------------------------
func _ready() -> void:
	body_entered.connect(_on_body_entered)
	body_exited.connect(_on_body_exited)


func _physics_process(delta: float) -> void:
	if _bodies.size() <= 0: return
	var base_damage : int = randi_range(min_damage, max_damage)
	var damage : int = min(1, floor(float(base_damage) * dpps * delta))
	for body : Node3D in _bodies.values():
		pass # Damage this smuck as well!

# ------------------------------------------------------------------------------
# Private Methods
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Public Methods
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Handler Methods
# ------------------------------------------------------------------------------
func _on_body_entered(body : Node3D) -> void:
	if body.name in _bodies: return
	if dpps > 0.0:
		_bodies[body.name] = body
	else:
		hit_occured.emit()
		pass # TODO: Hurt this smuck!


func _on_body_exited(body : Node3D) -> void:
	if body.name in _bodies:
		_bodies.erase(body.name)
